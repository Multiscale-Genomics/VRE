//>>built
require({cache:{"JBrowse/Plugin":function(){define("JBrowse/Plugin",["dojo/_base/declare","JBrowse/Component"],function(g,b){return g(b,{constructor:function(b){this.name=b.name;this.cssLoaded=b.cssLoaded;this._finalizeConfig(b.config)},_defaultConfig:function(){return{baseUrl:"/plugins/"+this.name}}})})},"RegexSequenceSearch/View/SearchSeqDialog":function(){define("dojo/_base/declare,dojo/dom-construct,dojo/aspect,dijit/focus,dijit/form/Button,dijit/form/RadioButton,dijit/form/CheckBox,dijit/form/TextBox,JBrowse/View/Dialog/WithActionBar".split(","),
function(g,b,o,j,n,l,h,i,a){return g(a,{constructor:function(){var k=this;o.after(this,"hide",function(){j.curNode&&j.curNode.blur();setTimeout(function(){k.destroyRecursive()},500)})},_dialogContent:function(){function k(c,a){var k=b.create("label",{},a),d=(new l(c)).placeAt(k);b.create("span",{innerHTML:c.label},k);return d}var c=this.content={},a=b.create("div",{className:"search-dialog"});b.create("div",{className:"search-dialog intro",innerHTML:"This tool creates tracks showing regions of the reference sequence (or its translations) that match a given DNA or amino acid sequence."},
a);var e=b.create("div",{className:"section"},a);b.create("span",{className:"header",innerHTML:"Search for"},e);var d=b.create("div",{className:"translateContainer"},e);k({name:"translate",value:"no",label:"DNA",checked:!0},d);c.translate=k({name:"translate",value:"yes",label:"AA"},d);c.searchBox=(new i({})).placeAt(e);e=b.create("div",{className:"section"},a);d=b.create("div",{className:"checkboxdiv"},e);c.caseIgnore=new h({label:"Ignore case",id:"search_ignore_case",checked:!0});d.appendChild(c.caseIgnore.domNode);
b.create("label",{"for":"search_ignore_case",innerHTML:"Ignore Case"},d);e=b.create("div",{className:"checkboxdiv"},e);c.regex=(new h({label:"Treat as regular expression",id:"search_as_regex"})).placeAt(e);b.create("label",{"for":"search_as_regex",innerHTML:"Treat as regular expression"},e);e=b.create("div",{className:"section"},a);b.create("span",{className:"header",innerHTML:"Search strands"},e);d=b.create("div",{className:"checkboxdiv"});c.fwdStrand=new h({id:"search_fwdstrand",checked:!0});var f=
b.create("div",{className:"checkboxdiv"});c.revStrand=new h({id:"search_revstrand",checked:!0});d.appendChild(c.fwdStrand.domNode);b.create("label",{"for":"search_fwdstrand",innerHTML:"Forward"},d);f.appendChild(c.revStrand.domNode);b.create("label",{"for":"search_revstrand",innerHTML:"Reverse"},f);e.appendChild(d);e.appendChild(f);return a},_getSearchParams:function(){var a=this.content;return{expr:a.searchBox.get("value"),regex:a.regex.checked,caseIgnore:a.caseIgnore.checked,translate:a.translate.checked,
fwdStrand:a.fwdStrand.checked,revStrand:a.revStrand.checked,maxLen:100}},_fillActionBar:function(a){var c=this;(new n({label:"Search",iconClass:"dijitIconBookmark",onClick:function(){var a=c._getSearchParams();c.callback(a);c.hide()}})).placeAt(a);(new n({label:"Cancel",iconClass:"dijitIconDelete",onClick:function(){c.callback(!1);c.hide()}})).placeAt(a)},show:function(a){this.callback=a||function(){};this.set("title","Add sequence search track");this.set("content",this._dialogContent());this.inherited(arguments);
j.focus(this.closeButtonNode)}})})},"RegexSequenceSearch/Store/SeqFeature/RegexSearch":function(){define("dojo/_base/declare,dojo/_base/array,dojo/_base/lang,JBrowse/Store/SeqFeature,JBrowse/Model/SimpleFeature,JBrowse/Errors,JBrowse/Util,JBrowse/CodonTable".split(","),function(g,b,o,j,n,l,h,i){return g(j,{constructor:function(a){this.searchParams=a.searchParams},_defaultConfig:function(){return h.deepUpdate(dojo.clone(this.inherited(arguments)),{regionSizeLimit:2E5})},getFeatures:function(a,b,c,
h){var e=o.mixin({orig:{start:a.start,end:a.end}},this.searchParams,a.searchParams);if(a.end-a.start>this.config.regionSizeLimit)throw new l.DataOverflow("Region too large to search");var d=this;this.browser.getStore("refseqs",function(f){f?f.getReferenceSequence(a,function(f){d.doSearch(a,f,e,b);c()},h):c()})},doSearch:function(a,k,c,i){var e=RegExp(c.regex?c.expr:this.escapeString(c.expr),c.caseIgnore?"gi":"g"),d=[];c.fwdStrand&&d.push([k,1]);c.revStrand&&d.push([h.revcom(k),-1]);b.forEach(d,function(d){if(c.translate)for(var b=
0;3>b;b++)this._searchSequence(a,d[0],e,d[1],i,!0,b);else this._searchSequence(a,d[0],e,d[1],i)},this)},_searchSequence:function(a,b,c,h,e,d,f){d&&(b=this.translateSequence(b,f));for(var f=f||0,d=d?3:1,i=a.start,a=a.end,m;null!==(m=c.exec(b))&&m.length;){c.lastIndex=m.index+1;var g=m[0],j=0<h?i+f+d*m.index:a-f-d*(m.index+g.length),l=0<h?i+f+d*(m.index+g.length):a-f-d*m.index,g=new n({data:{type:"SEARCH",start:j,end:l,searchMatch:g,strand:h},id:[j,l,g].join()});e(g)}},translateSequence:function(a,
b){for(var c=a.slice(b),c=c.slice(0,3*Math.floor(c.length/3)),h="",e=new i,e=e.generateCodonTable(e.defaultCodonTable),d=0;d<c.length;d+=3)var f=c.slice(d,d+3),h=h+e[f];return h},escapeString:function(a){return(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},saveStore:function(){return{searchParams:this.config.searchParams,regionSizeLimit:this.config.regionSizeLimit}}})})}}});
define("RegexSequenceSearch/main","dojo/_base/declare,dojo/_base/lang,dojo/Deferred,dijit/MenuItem,JBrowse/Plugin,./View/SearchSeqDialog".split(","),function(g,b,o,j,n,l){return g(n,{constructor:function(){this._searchTrackCount=0;this.browser.afterMilestone("initView",function(){this.browser.addGlobalMenuItem("file",new j({label:"Add sequence search track",iconClass:"dijitIconSearch",onClick:b.hitch(this,"createSearchTrack")}))},this)},createSearchTrack:function(){var b=this;(new l).show(function(i){if(i){var a=
{browser:b.browser,refSeq:b.browser.refSeq,type:"RegexSequenceSearch/Store/SeqFeature/RegexSearch",searchParams:i},g=b.browser.addStoreConfig(void 0,a);a.name=g;i={type:"JBrowse/View/Track/CanvasFeatures",label:"search_track_"+b._searchTrackCount++,key:"Search reference sequence for '"+i.expr+"'",metadata:{category:"Local tracks",Description:"Contains all matches of the text string/regular expression '"+a.searchExpr+"'"},store:g};b.browser.publish("/jbrowse/v1/v/tracks/new",[i]);b.browser.publish("/jbrowse/v1/v/tracks/show",
[i])}})}})});